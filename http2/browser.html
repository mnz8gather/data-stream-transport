<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    const startHttp2Stream = async () => {
      const response = await fetch('/http2-tls-stream', {
        headers: { Accept: 'application/json' },
      });

      if (!response.body) {
        console.error('HTTP/2 TLS No response body');
        return;
      }

      const reader = response.body.getReader();
      const decoder = new TextDecoder();

      while (true) {
        const { done, value } = await reader.read();
        if (done) {
          console.log('HTTP/2 TLS stream ended');
          break;
        }
        const chunk = decoder.decode(value, { stream: true });
        const lines = chunk.split('\n').filter((line) => line.trim());
        for (const line of lines) {
          try {
            const data = JSON.parse(line);
            console.log('Received HTTP/2 TLS stream data:', data.message);
          } catch (error) {
            console.error('HTTP/2 TLS Parse error:', error);
          }
        }
      }
    };

    // 启动 HTTP/2 TLS 流
    startHttp2Stream();
  </script>
</html>
